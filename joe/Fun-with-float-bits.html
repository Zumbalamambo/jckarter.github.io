<!DOCTYPE html>
<html>
<head>
<title>Fun with float bits</title>
<link rel="stylesheet" href="../durians.css">
<link rel="alternate" type="application/rss+xml" title="Durian Software: Joe's Blog" href="index.rss">
<script src="../durians.js"></script>
</head>
<body class="blog">
<div class="subtitle"><a href="index.html">Joe's blog</a></div>
<a href="../index.html"><img class="marquee" src="../durians.png"></a>
<div class="content">

<div class="sidebar">
<h4>About Me</h4>
<p>My name's Joe Groff. I'm a programmer in Portland, Oregon, USA.<br>
<br><script>male_to('com', 'joe', 'duriansoftware')</script>
<br>twitter <a href="http://twitter.com/jckarter">@jckarter</a>
<br>github <a href="http://github.com/jckarter">jckarter</a>
</p>
<h4>My Friends</h4>
<p>
<a href="http://bugsplat.info/">Peter Keen</a><br>
<a href="http://leto.net/">Jonathan Leto</a><br>
<a href="http://factor-language.blogspot.com/">Slava Pestov</a><br>
<a href="http://www.kssreeram.org/">KS Sreeram</a><br>
<a href="http://profile.myspace.com/index.cfm?fuseaction=user.viewprofile&friendid=189198983">The Summer Darlings</a>
</p>
</div>

<div class="blog">
<h3><a href="http://duriansoftware.com/joe/Fun-with-float-bits.html">Fun with float bits</a></h3>
<h4>updated January 4, 2009 20:39:18 PDT</h4>
<p>
So you've already read about <strike>John Carmack</strike>Michael Abrash's famous <a href="http://www.mceniry.net/papers/Fast%20Inverse%20Square%20Root.pdf">bit-molesting inverse square root function</a> a million times. You're looking to recapture that same thrill you felt the first time you felt up a float's skirt and messed with its bits, but
</p>
<h4>Logarithm</h4>
<<<log graph>>>
<p>Thanks to the way floats are represented, we can get something resembling a logarithm for a positive float just by reinterpreting its bits as an integer. For a single precision float, where the exponent is biased by 127 and the mantissa is 23 bits, converting a float <tt>x</tt> to its bits is equilavent to calculating <tt>2<sup>23</sup>(p + 127 + m)</tt>, where the exponent <tt>p = floor(log<sub>2</sub>x)</tt> and the mantissa <tt>m = x/p - 1</tt>. The exact integer part of the log<sub>2</sub> is encoded in the exponent, and we can use the float mantissa as a linear guess for the fractional part. We can tease it out by dividing by 2<sup>23</sup> and subtracting 127:
</p>
<pre>
float logarithmish(float x) {
    static const int BIAS = 127 << 23;
    static const float SHIFT = 1.0f/float(1 << 23);

    return float(*reinterpret_cast<int*>(&x) - BIAS)*SHIFT;
}
</pre>

</div>

<div class="cleared"></div>
<br><script>male_to('com', 'joe', 'duriansoftware', 'Email me')</script>
<br><a class="archives" href="archives.html">Archives</a>

<div style="clear:both"></div>
</div>

<div class="fineprint">
&copy; 2012 Durian Software. | <a href="../contact.html">Contact Us</a>
</div>
</body>
</html>
